<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: ui/ui_publish.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: ui/ui_publish.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @desc 发布操作区UI
 */
YE.UI.publish = {

  render: function() {
    var html = "&lt;div class='ye_box ye_box_publish' style='display:none;'>";
    html += "&lt;div class='ye_body ye_body_publish'>";
    html += "&lt;div class='ye_btn ye_btn_large ye_btnsub_large ye_act_save'>";
    html += "&lt;span class='ye_btn_text'>保存&lt;/span>";
    html += "&lt;/div>";
    html +=
      "&lt;div class='ye_btn ye_btn_large ye_btn_grey ml20 ye_act_preview'>";
    html += "&lt;span class='ye_btn_text'>预览&lt;/span>";
    html += "&lt;/div>";
    html +=
      "&lt;div class='ye_btn ye_btn_large ye_btn_grey ml20 ye_act_publish'>";
    html += "&lt;span class='ye_btn_text'>发布&lt;/span>";
    html +=
      "&lt;div class='ml8 f_14 c_gray ye_status_publish'>&lt;i class='ye_icon ye_icon_arrow_yellow_l'>&lt;/i>&lt;span class='ye_status_publish_hint'>今天还剩1次发布机会&lt;/span>&lt;/div>";
    html += "&lt;/div>";
    html += "&lt;/div>";
    html += "&lt;/div>";
    this.$publish_box = $(html).insertAfter(this.$container);
    this.$publish_btn = this.$publish_box.find(".ye_act_publish");
    this.$publish_status = this.$publish_box.find(".ye_status_publish_hint");
    this.$publish_preview = this.$publish_box.find(".ye_act_preview");
    this.$publish_save = this.$publish_box.find(".ye_act_save");
  },
  // 根据接口数据修改是否可发布以及可发布文章数目
  updateStatus: function(callback) {
    var _this = YE;
    var url = YE.config.domain + YE.URL_AJAX_GET_PUBLISHLIMIT;
    $.ajax({
      url: url,
      type: "post",
      dataType: "jsonp",
      success: function(res) {
        if (!res || res.code !== "100" || res.data === 0) {
          YE.UI.publish.disable.call(YE);
          return;
        }
        if (res.code === "100" &amp;&amp; res.data !== 0) {
          // 【important】评论和打赏只储存状态，不更新dom，由每个编辑器实例生成后再更新
          YE.limitStatus.enableDonate = res.data.donate_limit;
          YE.limitStatus.enableInsertAudio = res.data.audio_limit;
          YE.limitStatus.publish_limit = res.data.publish_limit;
          YE.limitStatus.enableComment = res.data.comment_limit;
          if (YE.limitStatus.publish_limit === 0) {
            YE.UI.publish.disable.call(YE, YE.limitStatus.publish_limit);
          } else {
            YE.UI.publish.enable.call(YE, YE.limitStatus.publish_limit);
          }
          // _this.$publish_box.show();
          if (callback) {
            callback();
          }
        }
      },
      error: function() {
        YE.Util.log.error("用户数据获取出错");
        YE.UI.publish.disable.call(YE);
      }
    });
  },
  // 设置为不可发布状态
  disable: function() {
    var _this = this;
    _this.$publish_btn.addClass('ye_btn-disable');
    _this.$publish_status.html("今天还剩0次发布机会");
  },
  // 设置为可发布状态
  enable: function(count) {
    var _this = this;
    _this.$publish_btn.removeClass('ye_btn-disable');
    _this.$publish_status.html("今天还剩" + count + "次发布机会");
  }
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="YKEditor.html">YKEditor</a></li></ul><h3>Namespaces</h3><ul><li><a href="YE.html">YE</a></li><li><a href="YE.Ajax.html">Ajax</a></li><li><a href="YE.Bind.html">Bind</a></li><li><a href="YE.Dialog.html">Dialog</a></li><li><a href="YE.Handler.html">Handler</a></li><li><a href="YE.Plugins.html">Plugins</a></li><li><a href="YE.UI.html">UI</a></li><li><a href="YE.Util.html">Util</a></li><li><a href="YKEditor_UI.html">UI</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.3</a> on Wed Nov 18 2015 10:31:06 GMT+0800 (CST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
