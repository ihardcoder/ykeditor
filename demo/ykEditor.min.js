/**! 优酷图文发布器  
 *@version: 1.0.0-2015/09/10
 *@author: zhoujunpeng
*/
var YE=function(a){var a=a||jQuery;UE.registerUI("yeimage",function(a,c){var d=new UE.ui.Button({name:c,title:"添加图片",label:"添加图片",onclick:function(){b.Ajax.getGallery("editor")}});return d},1),UE.registerUI("yelink",function(c,d){var e={REG_URL:/^((http[s]{0,1}:\/\/.+?\.)|((.\w+\.)?))youku\.com\/?.*?/,layer:null,$layer_dom:null,$title:null,$title_close:null,$title_error:null,$url:null,$url_close:null,$url_error:null,checkFlag:!0,isTitleValid:!1,isUrlValid:!1,$add_btn:null,binded:!1,init:function(){this.createlayer(),this.$layer_dom=a(this.layer.dom.winbox),this.$title=this.$layer_dom.find('input[name="linktitle"]'),this.$title_close=this.$layer_dom.find(".act-close-title"),this.$title_error=this.$layer_dom.find(".linktitle_error"),this.$url=this.$layer_dom.find('input[name="linkurl"]'),this.$url_close=this.$layer_dom.find(".act-close-url"),this.$url_error=this.$layer_dom.find(".linkurl_error"),this.$add_btn=this.$layer_dom.find('span[_for="add"]'),this.bindlayer(),this.showlayer()},createlayer:function(){if(null!==this.layer)return this;var a=this;this.layer=new b.Util.Qwindow({size:{width:830,height:590},posrefer:window,showhandle:!0,showmask:!0,elements:"",maskstyle:{color:"#000",opacity:.5},onhide:function(){a.clearInput(),a.hideError()}});var c=['<div class="qWindowBox" id="qWindowBox_yelink">','<div class="qWindowBox_yelink_head">添加链接</div>','<div class="qWindowBox_yelink_body">','<ul class="ye_ul ye_ul_yelink">','<li class="mb30 yelink_item yelink_item_url">','<p class="f_14 mb8">请输入链接地址</p>','<div class="input-control">','<div class="ye_icon ye_icon_close act-close-url" style="display: none;"></div>','<input type="text" class="ye_input" name="linkurl">',"</div>",'<p class="linkurl_subtag f_12 colorGrey">视频链接被添加后，会以播放器形式出现</p>','<span class="c_red linkurl_error" style="display:none">请输入链接地址</span>',"</li>",'<li class="mb30 yelink_item yelink_item_title">','<p class="f_14 mb8">请输入链接标题</p>','<div class="input-control">','<div class="ye_icon ye_icon_close act-close-title" style="display: none;"></div>','<input type="text" class="ye_input" name="linktitle">',"</div>",'<span class="c_red linktitle_error" style="display:none">请输入链接标题</span>',"</li>","</ul>",'<div class="qWindowBox_yelink_act">','<div class="ye_btn ye_btn_l ye_btnmaj_l ye_btn-disable">','<span class="ye_btn_text" _for="add">完成</span>',"</div> ","</div>","</div>","</div>"].join("");return this.layer.setContent("html",c),this},showlayer:function(){return null!==this.layer&&this.layer.show(),this},hidelayer:function(){return null!==this.layer&&this.layer.hide(),this},clearlayer:function(){return null===this.layer?this:void 0},bindlayer:function(){function a(){c.$title_close.hide()}function b(){c.$url_close.hide()}if(!this.binded){if(this.binded=!0,null===this.layer)return this;var c=this;this.$title_close.on("click",function(){c.$title.val(""),c.$title_error.show()}),this.$title.on("focus",function(){UE.browser.ie||c.$title_close.show()}).on("blur",function(){a(),""===c.$title.val()?c.$title_error.show():(c.$title_error.hide(),c.isTitleValid=!0),c.checkValid()}),this.$url_close.on("click",function(){c.$url.val(""),c.checkUrl()}),this.$url.on("focus",function(){UE.browser.ie||c.$url_close.show()}).on("blur",function(){b(),c.checkUrl(),c.checkValid()}),this.$add_btn.on("click",function(){c.insertLink()})}},checkValid:function(){this.isTitleValid&&this.isUrlValid?this.$layer_dom.find(".qWindowBox_yelink_act .ye_btn").removeClass("ye_btn-disable"):this.$layer_dom.find(".qWindowBox_yelink_act .ye_btn").addClass("ye_btn-disable")},clearInput:function(){var a=this;a.$title.val(""),a.$url.val("")},insertLink:function(){var a=this.checktitle(),b=this.checkUrl();if(a!==!1&&b!==!1){var d=this.$url.val();-1==d.indexOf("http://")&&(d="http://"+d);var e='<a href="'+d+'" target="_blank">'+this.$title.val()+"</a>";c.execCommand("inserthtml",e),this.hidelayer(),this.clearInput()}},checktitle:function(){var a=this.$title.val();return 0===a.length?(this.$title_error.html("请输入链接标题").show(),!1):(this.$title_error.hide(),!0)},checkUrl:function(){var a=this.$url.val();return 0===a
.length?(this.$url_error.html("请输入链接地址").show(),!1):this.REG_URL.test(a)?(this.isUrlValid=!0,this.$url_error.hide(),!0):(this.$url_error.html("请输入来自优酷网的链接地址").show(),!1)},hideError:function(){this.$url_error.hide(),this.$title_error.hide()}},f=new UE.ui.Button({name:d,title:"添加链接",label:"添加链接",onclick:function(){var b=a(this.getDom()).parents(".ye_body_editor").attr("id").split("_")[2];e.init(b)}});return f},2),UE.registerUI("yevideo",function(c,d){var e={layer:null,$layer_dom:null,all_video_url:b.config.domain+b.URL_AJAX_GET_VIDEO+"?tab=all_video",fav_video_url:b.config.domain+b.URL_AJAX_GET_VIDEO+"?tab=fav_video",other_video_url:b.config.domain+b.URL_AJAX_GET_VIDEO_BY_URL,isbinded:!1,isbinded_other:!1,pagename:"video",other_video_id:null,init:function(){var b=this;this.createlayer(),this.setQWmain(b.all_video_url),this.$layer_dom=a(this.layer.dom.winbox)},bind:function(){var b=this;this.$layer_dom.bind("click",function(a){b.pageview(a)}).on("click",".yevideo_item",function(c){a(this).hasClass("yevideo_item-focused")||(b.$layer_dom.find(".yevideo_item").removeClass("yevideo_item-focused"),b.$layer_dom.find(".yevideo_item input[type=radio]").attr("checked",!1),a(this).addClass("yevideo_item-focused"),a(this).find("input[type=radio]")[0].checked=!0,b.$layer_dom.find(".item-control .ye_btn").removeClass("ye_btn-disable"))}),this.isbinded=!0},bindOtherView:function(){var a=this;a.$layer_dom.find(".item-control .ye_btn").addClass("ye_btn-disable"),this.$layer_dom.bind("click",function(b){a.PageOtherView(b)}),this.isbinded_other=!0},pageview:function(b){var c=a(b.target),d=this;if("fav_video"===c.attr("id")&&!c.hasClass("select"))return void this.setQWmain(d.fav_video_url);if("all_video"===c.attr("id")&&!c.hasClass("select"))return void this.setQWmain(d.all_video_url);if("otherVideo"===c.attr("id")&&!c.hasClass("select"))return void this.setQWmain(d.other_video_url);if(c.attr("pageurl")&&0!==c.attr("pageurl").length){var e=c.attr("pageurl");this.setQWmain(e)}c.hasClass("form_btn_text")&&"完成"===c.html()&&"video"===this.pagename&&this.insertFlash()},PageOtherView:function(b){var c=Element.extend(Event.element(b)),d=this;if("select_video"==c.getAttribute("id")&&!c.hasClassName("select"))return void this.setQWmain(d.all_video_url);if(c.hasClassName("form_btn_text")&&"完成"==c.innerHTML&&"other"==this.pagename){if(!this.other_video_id)return a("#video_img").hide(),a("#video_title").hide(),void a("#item-noResult").show();this.insertFlash_other(this.other_video_id)}},showlayer:function(){return null!==this.layer&&this.layer.show(),this},hidelayer:function(){return null!==this.layer&&this.layer.hide(),this},createlayer:function(){null===this.layer&&(this.layer=new b.Util.Qwindow({size:{width:830,height:590},posrefer:window,showhandle:!0,showmask:!0,elements:"",maskstyle:{color:"#000",opacity:.5}}))},insertFlash:function(){var a=this.$layer_dom.find('input[type="radio"][name="video"]:checked');if(!a||0===a.length)return void alert("请选择视频");var b=a.attr("encode_id");this.insertFlash_other(b)},insertFlash_other:function(a){if(!a)return void alert("视频选择有误！");this.hidelayer();var b="http://player.youku.com/player.php/sid/"+a+"/v.swf",d='<embed  id="[ye_video_start]'+a+'[ye_video_end]" src="'+b+'" wmode="transparent" allowFullScreen="true" quality="high" width="100%" height="400" align="middle" allowScriptAccess="always" type="application/x-shockwave-flash">';c.execCommand("inserthtml",d),c.execCommand("insertparagraph")},setLoading:function(){this.layer||this.createlayer();var a=['<div class="qWindowBox">','<div class="loadingBox">','<div class="loading"><img src="'+b.config.domain+'/u/img/pushdy/loading_64.gif"></div>',"</div>","</div>"].join("");this.layer.setContent("html",a),this.showlayer()},setQWmain:function(c){var d=this;d.setLoading(),a.ajax({url:c,type:"post",dataType:"jsonp",timeout:3e3,error:function(){d.layer.hide(),b.Dialog.error("请求失败！")},complete:function(a,c){"timeout"===c?b.Dialog.error("请求超时！"):d.isRes||(d.layer.hide(),b.Dialog.error("网络故障！"))},success:function(e){d.isRes=!0,"100"===e.code&&(c===d.other_video_url?d.pagena
me="other":d.pagename="video",d.layer.setContent("html",'<div class="qWindowBox" id = "qWindowBox_yevideo"><div class="qWindowBox_yevideo_head">添加视频</div><div class="qWindowBox_yevideo_body">'+e.data+"</div></div>"),"video"===d.pagename&&d.isbinded===!1?d.bind():"other"==d.pagename&&(a("#search_video").on("blur",function(c){var e=a("#search_video").val(),f={};f={type:"push_subscribe",act:"getVideoByUrl",video_url:e},a.ajax({url:b.config.domain+"/u/",type:"get",data:f,success:function(b){var c=JSON.parse(b);d.other_video_id=c.encode_id,!d.other_video_id||null===c||0>c?(a("#item-other").hide(),a("#item-noResult").show()):(a("#video_img").html('<img src="'+c.thumburl_v2+'">'),a("#video_title").html(c.title),a("#item-noResult").hide(),a("#item-other").show(),d.$layer_dom.find(".item-control .ye_btn").removeClass("ye_btn-disable"))}})}),d.isbinded_other===!1&&d.bindOtherView()))}}),this.showlayer()}},f=new UE.ui.Button({name:d,title:"添加视频",label:"添加视频",onclick:function(){var b=a(this.getDom()).parents(".ye_body_editor").attr("id").split("_")[2];e.init(b)}});return f},0),UE.registerUI("yevote",function(c,d){var e="",f="",g=a("<div id='ye_votebox' style='display:none'></div>").appendTo(a(document.body));a(window).on("voteinitial",function(){var a="<div class='yevote_box' voteid='"+f+"'><div  contenteditable='false'><div class='yevote_box_cover' onclick='return false;' contentEditable='false' enable='false'></div>"+g.html()+"</div></div>";c.execCommand("inserthtml",a),g.html("");try{b.dialog_cover.hide()}catch(d){}}).on("getpluginfail",function(){try{b.dialog_cover.hide(),b.Dialog.error("操作失败，请重试")}catch(a){}});var h=new UE.ui.Button({name:d,title:"添加投票",label:"添加投票",onclick:function(){var c=get_username("all").userid;window.pluginPanel.launchVotePanel({callback:function(c){b.Dialog.cover(),e="YK_interact_plugins_container_"+c+"_5_2_3_4",f=c;var d=a("."+e);0===d.length&&(d=a("<div></div>").addClass(e),g.append(d)),window.pluginFrontEnd.createPlugin(d[0])},create_id:c,create_source:3,device:5})}});return h},3);var b={REG_CHAR:/^[\w_]+$/,REG_LINK:/.*?\.?(youku|tudou|laifeng|soku)\.com/,REG_LINK_MAIL:/^mailto\:.*?\@.*/,REG_IMG:/.*?\.?(youku|ykimg)\.com/,MAX_NUM_ARTICLE:1,MAX_COUNT_TITLE:40,MAX_COUNT_SUMMARY:40,MAX_COUNT_DONATETITLE:20,MAX_COUNT_DONATEFLAG:100,MAX_COUNT_CONTENT:2e4,MAX_COUNT_GALLERY_CHECKED:5,URL_AJAX:"/u/pushsub/",URL_AJAX_PUBLISH:"/u/pushsub/publishPushArticle",URL_AJAX_SEND:"/u/pushsub/sendPushArticle",URL_AJAX_DEL:"/u/pushsub/delPushArticle",URL_AJAX_GET_VIDEO:"/u/pushsub/getVideoList",URL_AJAX_GET_VIDEO_BY_URL:"/u/pushsub/getVideoByUrl",URL_UPLOAD_IMG:"/u/pushsub/uploadPushImage",URL_AJAX_GET_PUBLISHLIMIT:"/u/pushsub/getPushLimit",URL_AJAX_GET_DRAFT:"/u/pushsub/getPushArticleList",URL_AJAX_GET_DONATEID:"http://hudong.pl.youku.com/interact/libs/set/plugin",URL_AJAX_GET_GALLERY:"/u/pushsub/getMaterial",URL_AJAX_DEL_GALLERYL:"/u/pushsub/delMaterial",URL_AJAX_GET_PREVIEW:"/u/pushsub/getPreview",FAKE_ID:1,id:"",limitStatus:{publish_limit:1,enableDonate:!1,enableComment:!0},isBindUnload:!0,$container:null,checked_id:[],checked_img:{},res_status:{uploadGE:!1,uploadCV:!1,uploadQW:!1},init_timestamp:null,instances:{count:0},config:{domain:"http://"+window.location.host,emptyCV:"/u/img/ykeditor/blank-cover.png",editor:{width:"100%",height:500}},defaultOpts:{ISHEADERFIXED:!0,HEIGHT_HEADER:60,editor:{serverUrl:"",toolbars:[["fontsize","forecolor","bold","italic","underline"],["yeimage","yevideo","yelink"]],wordCount:!1,elementPathEnabled:!1,enableContextMenu:!1,retainOnlyLabelPasted:!0,pasteplain:!1,scaleEnabled:!1,enableAutoSave:!1,allowDivTransToP:!1,autoFloatEnabled:!1,customDomain:!0,fontsize:[10,12,14,16,18,20,24],initialStyle:"img{max-width:100%;display:block;} .donateBox_fake{display:none;visibility:hidden;} .yevote_box{position:relative;} .yevote_box .yevote_box_cover{position:absolute;width:100%;height:100%;background-color:#555;z-index:100;opacity:0.2;filter: alpha(opacity=0.2);}",iframeCssUrl:"http://static.youku.com/plugins/pluginFrontEndV2/o/css/main.min.css"}},Ajax:{},UI:{},Util:{},Bind:{},Handler:{},Dialog:{
},data_draft:null,$publish_box:null,$publish_btn:null,$publish_status:null,getEditor:function(d,e){if(!d||!this.REG_CHAR.test(d))return void this.Util.log.error("invalid id");document.domain="youku.com";var f=this;if(this.id=d,this.editor_opt=a.extend({},f.defaultOpts.editor,e.editor),this.opt=a.extend({},f.defaultOpts,e,{editor:this.editor_opt}),this.$container=a("#"+d),0===this.$container.length)return void this.Util.log.error("invalid id");this.$container.css("position","relative");var g=this.init_timestamp=b.Util.getTimestamp(),h=this.instances[g];h||(h=this.instances[g]=new c(g,this.opt),this.instances.count++),this.UI.render.call(this),this.UI.publish.updateStatus.call(this),setTimeout(function(){f.Ajax.loadDraft.call(f)},1e3),this.bind()},bind:function(){var a=this;a.Bind.addArticle.call(a),a.Bind.publish.call(a),a.Bind.gallery.call(a),a.Bind.preview.call(a)},updateDraft:function(){var a=this,d=a.data_draft;if(d){var e=0,f=d.length;for(e=0;f>e&&e!==f-1;e++){var g=b.Util.getTimestamp();a.instances[g]=new c(g,a.opt,d[e],!0)}var h=setInterval(function(){a.instances[a.init_timestamp].isComplete&&(a.instances[a.init_timestamp].updateDraft(d[f-1]),clearInterval(h))},200);a.Ajax.getArticleLimit.call(a)}},updateArticleLimit:function(){var b=this,c=b.$container.children(),d=a(c[c.length-1]);c.find(".ye_cover_add").hide(),b.instances.count<b.MAX_NUM_ARTICLE&&d.find(".ye_cover_add").show()},saveActive:function(){var a=this;for(var b in a.instances)"count"!==b&&a.instances[b].active&&a.instances[b].autosave()},disableAll:function(){var a=this;for(var b in a.instances)"count"!==b&&a.instances[b].disable()},updateGallery:function(c){var d=this,e="cover"===c?1:b.MAX_COUNT_GALLERY_CHECKED;a("#qWindowBox_yegallery .qWindowBox_yegallery_slectedsum").html("已选"+b.checked_id.length+"个，可选"+e+"个"),0!==d.checked_id.length&&(a("#qWindowBox_yegallery .qWindowBox_yegallery_act_btn").removeClass("ye_btn-disable"),a.each(d.checked_id,function(b,c){a("#qWindowBox_yegallery .yegallery_gallery_item[_id="+c+"]").addClass("yegallery_gallery_item-checked")}))}};b.options={UEDITOR_HOME_URL:"UEDITOR_HOME_URL",serverUrl:"serverUrl",toolbars:"toolbars",elementPathEnabled:"elementPathEnabled",wordCount:"wordCount",enableContextMenu:"enableContextMenu",scaleEnabled:"scaleEnabled",enableAutoSave:"enableAutoSave",autoFloatEnabled:"autoFloatEnabled",customDomain:"customDomain",fontsize:"fontsize",initialStyle:"initialStyle",iframeCssUrl:"iframeCssUrl",allowDivTransToP:"allowDivTransToP"},b.Bind.addArticle=function(){function a(){var a=b;if(!(a.instances.count>=a.MAX_NUM_ARTICLE)){var d=a.Util.getTimestamp();for(var e in a.instances)"count"!==e&&a.instances[e].disable();a.instances[d]=new c(d,a.opt);a.instances.count++,a.updateArticleLimit()}}var d=this;d.$container.on("click",".ye_cover_add",a)},b.Bind.gallery=function(){function c(a){var b=a,c=/\.[^\.]+$/.exec(b)[0];return c=c.toLowerCase(),".png"!=c&&".jpg"!=c&&".jpeg"!=c&&".gif"!=c?!1:!0}function d(){h="cover"===b.dialog_gallery.target?1:b.MAX_COUNT_GALLERY_CHECKED,a("#qWindowBox_yegallery .qWindowBox_yegallery_slectedsum").html("已选"+b.checked_id.length+"个，可选"+h+"个"),0!==b.checked_id.length?a("#qWindowBox_yegallery .qWindowBox_yegallery_act_btn").removeClass("ye_btn-disable"):a("#qWindowBox_yegallery .qWindowBox_yegallery_act_btn").addClass("ye_btn-disable")}var e="yegallery_gallery_item-checked",f=null,g="",h=0,i=0,j="",k=0,l="",m=null,n=['<li class="yegallery_gallery_item yegallery_gallery_item-fake">','<div class="gallery_item_thumb">','<div class="thumb_cover thumb_cover_checked"></div>','<img class="thumb_img" src="/u/img/ykeditor/uploading.jpg">','<span class="ye_icon ye_icon_close_cube"></span>',"</div>",'<div class="gallery_item_entry">','<span class="entry_name">上传中...</span>',"</div>","</li>"].join("");a(document).on("click","#qWindowBox_yegallery .yegallery_gallery_item",function(c){return h="cover"===b.dialog_gallery.target?1:b.MAX_COUNT_GALLERY_CHECKED,a(this).hasClass("yegallery_gallery_item-fake")?!1:(a(this).hasClass("yegallery_gallery_item-checked")?(a(this).removeClass(e),i=a(this).attr
("_id"),k=a.inArray(i,b.checked_id),b.checked_id.splice(k,1)):(1===h?(a("#qWindowBox_yegallery .yegallery_gallery_item").removeClass(e),a(this).addClass(e),b.checked_id=[],i=a(this).attr("_id"),b.checked_id.push(i)):b.checked_id.length<h&&(a(this).addClass(e),i=a(this).attr("_id"),b.checked_id.push(i)),m=a(this).find(".thumb_img"),b.checked_img[i]={src:m.attr("src"),w:m.attr("_width")||"0",h:m.attr("_height")||"0"}),void d())}).on("click","#qWindowBox_yegallery .qWindowBox_yegallery_act_btn",function(c){if(0!==b.checked_id.length&&!a(this).hasClass("ye_btn-disable")){for(var d in b.instances)"count"!==d&&b.instances[d].active&&(f=b.instances[d]);"cover"===b.dialog_gallery.target?(j=b.checked_img[b.checked_id[0]].src,f.$cover_preview_img.attr("src",j),f.$cover_preview_box.show(),f.data.cover=j,f.status.cover=1,f.UI.articlelist.updateCover.call(f),f.$cover_error.hide(),f.autosave()):"editor"===b.dialog_gallery.target&&(l="",a.each(b.checked_id,function(a,c){j=b.checked_img[c].src,l+="<img src="+j+" _width="+b.checked_img[c].w+" _height="+b.checked_img[c].h+">"}),f.ueditor.execCommand("inserthtml",l),f.autosave()),b.dialog_gallery.hide()}}).on("click","#qWindowBox_yegallery .ye_icon_close_cube",function(c){var d=c||window.event;d&&d.stopPropagation?d.stopPropagation():d.cancelBubble=!0,b.checked_id=[],g=b.dialog_gallery.target,b.Dialog.gallery("loading",g);var e=b.URL_AJAX_DEL_GALLERYL+"?material_id="+a(this).attr("_id");return a.ajax({url:e,dataType:"jsonp",error:function(){b.Dialog.gallery("error",g)},complete:function(a,c){"timeout"===c&&b.Dialog.gallery("error",g)},success:function(a){a&&"100"===a.code||b.Dialog.gallery("error",g),b.Ajax.getGallery(g)}}),!1}).on("change","#qWindowBox_yegallery .yegallery_upload_file, #yegallery_upload_form_empty .yegallery_upload_file_empty",function(){if(""!==a(this).val()){var d=c(a(this).val());if(d){var e=a(this).val().split("fakepath\\")[1];a("#qWindowBox_yegallery .yegallery_gallery_list").prepend(n),a("#qWindowBox_yegallery .yegallery_gallery_item-fake .entry_name").html(e),a(this).hasClass("yegallery_upload_file_empty")?(a(".yegallery_gallery_empty").hide(),a("#yegallery_upload_form_empty").submit()):a("#yegallery_upload_form").submit(),b.res_status.uploadGE=!1;var f=setTimeout(function(){b.res_status.uploadGE?clearTimeout(f):a("#qWindowBox_yegallery .yegallery_gallery_item-fake .thumb_img").attr("src","/u/img/ykeditor/upload-error.jpg")},1e4)}else alert("图片格式错误")}}).on("click","#qWindowBox_yegallery .qPager_gallery a",function(){var c=a(this).attr("_page");if(c){var d=b.URL_AJAX_GET_GALLERY+"?page="+c;g=b.dialog_gallery.target,b.Ajax.getGallery(g,d)}}).on("click","#qWindowBox_yegallery .yegallery_gallery_error_act",function(){g=b.dialog_gallery.target,b.Ajax.getGallery(g)})},b.Bind.preview=function(){var b=this;a(document).on("click","#qWindowBox_yepreview .preview_qcode_cover",function(a){for(var c in b.instances)if("count"!==c&&b.instances[c].active)return b.instances[c].Ajax.getPreview.call(b.instances[c]),!1})},b.Bind.publish=function(){var a=this,c=function(){b.Dialog.cover();for(var c in a.instances)"count"!==c&&a.instances[c].Ajax.getDonateId.call(a.instances[c])},d=function(){if(0===a.limitStatus.publish_limit)return void a.$publish_status.parent().addClass("ye_status_publish-error");var b=!1;for(var d in a.instances)if("count"!==d&&(b=a.instances[d].checkAbleToPost("publish"),!b))return void a.instances[d].showErrors();b&&a.Dialog.confirm("发布后将无法修改，确认发布么？",function(){a.limitStatus.enableDonate?c():e()})},e=function(){for(var b in a.instances)if("count"!==b){var c=a.Util.formatLinks.call(a.instances[b]);c&&a.instances[b].ueditor.setContent(a.instances[b].data.content),a.instances[b].active&&a.instances[b].Ajax.sendArticle.call(a.instances[b],"publish")}},f=function(){var c;for(var d in a.instances)if("count"!==d&&a.instances[d].active){c=a.instances[d];break}var e=c.checkAbleToPost("preview");if(e){var f=b.Util.formatLinks.call(c);f?b.Dialog.confirm("站外链接将被过滤，是否继续？",function(){c.ueditor.setContent(c.data.content),c.Ajax.sendArticle.call(c,"preview")}):c.Ajax.sendArticle
.call(c,"preview")}else c.showErrors()},g=function(){for(var b in a.instances)if("count"!==b&&a.instances[b].active){a.instances[b].autosave("manual");break}};a.$publish_btn.on("click",d),a.$publish_btn.on("publish",e),a.$publish_preview.on("click",f),a.$publish_save.on("click",g)},b.Bind.unload=function(){var b=this;a(window).on("beforeunload",function(){return b.isBindUnload?(b.saveActive(),"编辑内容已自动保存"):void 0})},b.UI.render=function(){var a=this;a.UI.publish.render.call(a)},b.UI.publish={render:function(){var b="<div class='ye_box ye_box_publish' style='display:;'>";b+="<div class='ye_body ye_body_publish'>",b+="<div class='ye_btn ye_btn_large ye_btnsub_large ye_act_save'>",b+="<span class='ye_btn_text'>保存</span>",b+="</div>",b+="<div class='ye_btn ye_btn_large ye_btn_grey ml20 ye_act_preview'>",b+="<span class='ye_btn_text'>预览</span>",b+="</div>",b+="<div class='ye_btn ye_btn_large ye_btn_grey ml20 ye_act_publish'>",b+="<span class='ye_btn_text'>发布</span>",b+="<div class='ml8 f_14 c_gray ye_status_publish'><i class='ye_icon ye_icon_arrow_grey_l'></i><span class='ye_status_publish_hint'>今天还剩1次发布机会</span></div>",b+="</div>",b+="</div>",b+="</div>",this.$publish_box=a(b).insertAfter(this.$container),this.$publish_btn=this.$publish_box.find(".ye_act_publish"),this.$publish_status=this.$publish_box.find(".ye_status_publish_hint"),this.$publish_preview=this.$publish_box.find(".ye_act_preview"),this.$publish_save=this.$publish_box.find(".ye_act_save")},updateStatus:function(){var c=b.config.domain+b.URL_AJAX_GET_PUBLISHLIMIT;a.ajax({url:c,type:"post",dataType:"jsonp",success:function(a){return a&&"100"===a.code&&0!==a.data?void("100"===a.code&&0!==a.data&&(b.limitStatus.enableDonate=a.data.donate_limit,b.limitStatus.publish_limit=a.data.publish_limit,b.limitStatus.enableComment=a.data.comment_limit,0===b.limitStatus.publish_limit?b.UI.publish.disable.call(b,b.limitStatus.publish_limit):b.UI.publish.enable.call(b,b.limitStatus.publish_limit))):void b.UI.publish.disable.call(b)},error:function(){b.Util.log.error("用户数据获取出错"),b.UI.publish.disable.call(b)}})},disable:function(){var a=this;a.$publish_btn.addClass("ye_btn-disable"),a.$publish_status.html("今天还剩0次发布机会")},enable:function(a){var b=this;b.$publish_btn.removeClass("ye_btn-disable"),b.$publish_status.html("今天还剩"+a+"次发布机会")}},b.Util.textfilter=function(a,b){var c=/(<(s|S)cript>)|(<\/(s|S)cript>)/g,d="";switch(b){case"script":d=a.replace(c,"script"),d===a&&(d="")}return d},b.Util.getTimestamp=function(){var a=new Date;return a.valueOf()||data.getTime()},b.Util.clearVoteExtra=function(b){var c="",d=a("<div>"+b+"</div>");return d.find(".yevote_box").html(""),c=d.html()},b.Util.format_date=function(a,b){var c={"M+":a.getMonth()+1,"d+":a.getDate(),"h+":a.getHours(),"m+":a.getMinutes(),"s+":a.getSeconds(),"q+":Math.floor((a.getMonth()+3)/3),S:a.getMilliseconds()};/(y+)/.test(b)&&(b=b.replace(RegExp.$1,(a.getFullYear()+"").substr(4-RegExp.$1.length)));for(var d in c)new RegExp("("+d+")").test(b)&&(b=b.replace(RegExp.$1,1==RegExp.$1.length?c[d]:("00"+c[d]).substr((""+c[d]).length)));return b},b.Util.formatLinks=function(){var c=this,d=c.data.content||"",e=!1;if(""!==d){var f=a("<div>"+d+"</div>"),g=f.find("a"),h=f.find("iframe");0!==g.length&&a.each(g,function(c,d){var f=a(d).attr("href");f&&(UE.browser.ie&&b.REG_LINK_MAIL.test(f)?(e=!0,a(d).replaceWith(a("<span>"+a(d).html()+"</span>"))):b.REG_LINK.test(f)||(e=!0,a(d).attr("href","http://www.youku.com/")))}),0!==h.length&&a.each(h,function(c,d){var f=a(d).attr("src");b.REG_LINK.test(f)||(e=!0,a(d).attr("src",""))}),e&&(c.data.content=f.html())}return e},b.Util.log={error:function(a){console&&console.error(a)}},b.Util.mapOpts=function(a){if(a&&"[object Object]"===Object.prototype.toString.call(a)){var c=b.options,d={};for(var e in a)d[c[e]]=a[e];return d}},b.Util.Qwindow=function(a){this.config={title:"",size:{width:320,height:200},mode:"normal",posrefer:window,pos:{top:"middle",left:"center"},content:{type:"html",value:""},maskstyle:{color:"#545454",opacity:.5},showmask:!0,showhandle:!0,zindex:3e4,scrolling:!1,elements:"object,e
mbed,select",onshow:function(){},onhide:function(){},ondestroy:function(){}},this.config=arguments[0]?"object"==typeof arguments[0]?this._mergeConfig(this.config,a):a:this.config,this.isIE=document.all?!0:!1,this.isIE6=this.isIE&&!window.XMLHttpRequest,this.init()},b.Util.Qwindow.prototype={init:function(){this.status="hide",this.isDestroy=!1,this.dom={},this.dom.win=document.createElement("div"),this.dom.win.className="ye_qwindow",this.dom.winbox=document.createElement("div"),this.dom.winbox.className="ye_winbox",this.dom.winbg=document.createElement("div"),this.dom.winbg.className="ye_winbg",this.dom.winhead=document.createElement("div"),this.dom.winhead.className="ye_winhead",this.dom.wintitle=document.createElement("div"),this.dom.wintitle.className="ye_wintitle",this.dom.winclose=document.createElement("div"),this.dom.winclose.className="ye_winclose",this.dom.winbody=document.createElement("div"),this.dom.winbody.className="ye_winbody",this.dom.winmask=document.createElement("div"),this.dom.winmask.className="ye_qwindow_mask",this.config.title&&this.setTitle(this.config.title).showTitle(),this.config.size&&this.setSize(this.config.size.width,this.config.size.height),this.config.content&&this.setContent(this.config.content.type,this.config.content.value),"fixed"==this.config.mode&&this.setMode("fixed"),this.config.showhandle&&this.showHandle(),this.setMaskstyle(this.config.maskstyle.color,this.config.maskstyle.opacity),this.setElements(this.config.elements),this.setzIndex(this.config.zindex),this.dom.winhead.appendChild(this.dom.wintitle),this.dom.winhead.appendChild(this.dom.winclose),this.dom.winbox.appendChild(this.dom.winhead),this.dom.winbox.appendChild(this.dom.winbody),this.dom.win.appendChild(this.dom.winbox),this.dom.win.appendChild(this.dom.winbg),document.body.appendChild(this.dom.winmask),document.body.appendChild(this.dom.win),this.bind()},destroy:function(){if(this.isDestroy||!this.dom.win||!this.dom.winmask||!this.dom.win.parentNode||!this.dom.winmask.parentNode)return!1;this.isDestroy=!0,"function"==typeof this.config.ondestroy&&this.config.ondestroy();var a=this.dom.win.getElementsByTagName("iframe")[0];return a&&a.parentNode.removeChild(a),this.dom.win.parentNode.removeChild(this.dom.win),this.dom.winmask.parentNode.removeChild(this.dom.winmask),!0},bind:function(){var a=this;this.dom.winclose.onclick=function(){a.hide()};var b=function(){var b=a.getStatus();"show"==b&&a.rePos().resizeMask()};return window.addEventListener?window.addEventListener("resize",function(){setTimeout(b,10)},!1):window.attachEvent&&window.attachEvent("onresize",function(){setTimeout(b,10)}),this},_setOpacity:function(a,b){return a?(document.all?a.style.filter="alpha(opacity="+100*b+")":a.style.opacity=b,!0):!1},show:function(){var a=this.getPos();return this.setPos(a.top,a.left),this.hideElements(),this.isIE||this._setOpacity(this.dom.win,1),this.dom.win.style.visibility="visible",this.status="show",this.config.showmask&&(this.resizeMask(),this.dom.winmask.style.display="block"),"function"==typeof this.config.onshow&&this.config.onshow(),this},hide:function(){return this.showElements(),this.isIE||this._setOpacity(this.dom.win,0),this.dom.win.style.visibility="hidden",this.dom.winmask.style.display="none",this.status="hide","function"==typeof this.config.onhide&&this.config.onhide(),this},getStatus:function(){return this.status},toggle:function(){var a=this.getStatus();return"show"==a?this.hide():"hide"==a&&this.show(),this},reload:function(){},clearContent:function(){var a=this.dom.win.getElementsByTagName("iframe")[0];return a&&a.parentNode.removeChild(a),this.dom.winbody.innerHTML="",this},setMode:function(a){var b="normal";return b="fixed"==a?"fixed":"normal",this.config.posrefer!=window||this.isIE6||(this.dom.win.style.position="fixed"==b?"fixed":"absolute",this.config.mode=b,this.rePos()),this},setContent:function(a,b){if(this.config.content.type=a,this.config.content.value=b,this.clearContent(),"html"==a||"element"==a){if("html"==a)this.dom.winbody.innerHTML=b;else{if(!b)return!1;this.dom.winbody.appendChild(b)}this.c
onfig.scrolling?this.dom.winbody.style.overflow="auto":this.dom.winbody.style.overflow="hidden"}else if("iframe"==a){this.dom.winbody.style.overflow="hidden";var c=document.createElement("iframe");c.frameBorder="0",c.scrolling=this.config.scrolling?"auto":"no",this.dom.winbody.appendChild(c),setTimeout(function(){c.src=b},10)}return this},setScrolling:function(a){if(this.config.scrolling!=a)if(this.config.scrolling=a,"iframe"==this.config.content.type){if(iframe=this.dom.winbody.getElementsByTagName("iframe")[0],iframe){this.dom.winbody.style.overflow="hidden";var b=document.createElement("iframe");b.frameBorder="0",b.scrolling=a?"auto":"no",b.src=this.config.content.value,iframe.parentNode.removeChild(iframe),this.dom.winbody.appendChild(b)}}else a?this.dom.winbody.style.overflow="auto":this.dom.winbody.style.overflow="hidden";return this},getSize:function(){return this.config.size},getRealsize:function(){return{width:this.dom.win.scrollWidth,height:this.dom.win.scrollHeight}},setSize:function(a,b){var c=parseInt(a,10),d=parseInt(b,10);return this.config.size.width=c,isNaN(c)||(this.dom.winbody.style.width=c+"px",this.dom.winhead.style.width=c+"px"),isNaN(d)||(this.config.size.height=d,this.dom.winbody.style.height=d+"px"),this.rePos(),this},getPos:function(){return this.config.pos},setPosrefer:function(a){return a?(this.config.posrefer=a,this.rePos(),this):!1},setPos:function(a,b){var c=this.config.posrefer!=window?isNaN(parseInt(a,10))?0:parseInt(a,10):a,d=this.config.posrefer!=window?isNaN(parseInt(b,10))?0:parseInt(b,10):b,e=this.getRealsize(),f=this.config.posrefer!=window?{width:this.config.posrefer.offsetWidth,height:this.config.posrefer.offsetHeight}:this._getClientRange(),g=this.config.posrefer!=window?this._getOffsetPos(this.config.posrefer):"fixed"==this.config.mode?{top:0,left:0}:this._getWindowScroll();return c="top"==a?g.top:"middle"==a?g.top+parseInt((f.height-e.height)/2):"bottom"==a?g.top+(f.height-e.height):g.top+parseInt(a,10),d="left"==b?g.left:"center"==b?g.left+parseInt((f.width-e.width)/2):"right"==b?g.left+parseInt(f.width-e.width):g.left+parseInt(b,10),this.config.pos.top=a,this.config.pos.left=b,this.dom.win.style.top=c+"px",this.dom.win.style.left=d+"px",this},rePos:function(){var a=this.getPos();return this.setPos(a.top,a.left),this},getTitle:function(){return this.config.title},setTitle:function(a){var b=a.toString();return this.config.title=b,this.dom.wintitle.innerHTML=b,this},showTitle:function(){return this.dom.wintitle.style.display="block",this.rePos(),this},hideTitle:function(){return this.dom.wintitle.style.display="none",this.rePos(),this},showHandle:function(){return this.dom.winclose.style.display="block",this},hideHandle:function(){return this.dom.winclose.style.display="none",this},showMask:function(){return this.config.showmask=!0,"hide"!=this.status?(this.resizeMask(),this.dom.winmask.style.display="block",this):void 0},hideMask:function(){return this.dom.winmask.style.display="none",this.config.showmask=!1,this},resizeMask:function(){var a=this._getScrollRange(),b=this._getClientRange(),c=b.height>a.height?b:a;return this.dom.winmask.style.width=c.width+"px",this.dom.winmask.style.height=c.height+"px",this},getElements:function(){return this.dom},setMaskstyle:function(a,b){return this.config.maskstyle.color=a,this.config.maskstyle.opacity=b,
this.dom.winmask.style.backgroundColor=a,document.all?this.dom.winmask.style.filter="alpha(opacity="+100*b+")":this.dom.winmask.style.opacity=b,this},setzIndex:function(a){var b=parseInt(a,10);return this.config.zindex=b,this.dom.win.style.zIndex=b,this.dom.winmask.style.zIndex=b,this},getzIndex:function(){return this.config.zindex},setShowCallback:function(a){return"function"==typeof a?this.config.onshow=a:this.config.onshow=function(){},this},setHideCallback:function(a){return"function"==typeof a?this.config.onhide=a:this.config.onhide=function(){},this},setDestroyCallback:function(a){return"function"==typeof a?this.config.ondestroy=a:this.config.ondestroy=function(){},this},setElements:function(a){return this.elements=null,a&&(this.config.elements=a.split(",")),this},showElements:function(){if(this.elements)for(var a=0,b=this.elements.length;b>a;a++){var c=this.elements[a];c.style.visibility="visible"}return this},hideElements:function(){this.elements=[];var a,b,c,d=this.config.elements;for(a=0,b=d.length;b>a;a++)for(var e=d[a],f=document.getElementsByTagName(e),g=0,h=f.length;h>g;g++)c=f[g],this.elements.push(c);for(a=0,b=this.elements.length;b>a;a++)c=this.elements[a],c.style.visibility="hidden";return this},_getWindowScroll:function(){var a=document.documentElement.scrollTop||document.body.scrollTop,b=document.documentElement.scrollLeft||document.body.scrollLeft;return{top:a,left:b}},_getScrollRange:function(){var a=0,b=0;return a=document.documentElement.scrollWidth||document.body.scrollWidth,b=document.documentElement.scrollHeight||document.body.scrollHeight,{width:a,height:b}},_getClientRange:function(){var a=0,b=0;return a=document.documentElement.clientWidth||document.body.clientWidth,b=document.documentElement.clientHeight||document.body.clientHeight,{width:a,height:b}},_getOffsetPos:function(a){if(a.getBoundingClientRect){var b=0,c=0;try{var d=a.getBoundingClientRect(),e=document.documentElement;b=d.left+Math.max(e.scrollLeft,document.body.scrollLeft)-e.clientLeft,c=d.top+Math.max(e.scrollTop,document.body.scrollTop)-e.clientTop}catch(f){}return{top:c,left:b}}var g=function(a){try{return a.offsetParent?a.offsetLeft+g(a.offsetParent):a.offsetLeft}catch(b){return 0}},h=function(a){try{return a.offsetParent?a.offsetTop+h(a.offsetParent):a.offsetTop}catch(b){return 0}};return{top:h(a),left:g(a)}},_mergeConfig:function(a,b,c){a=a||{};var d,e=typeof b,f=1;for(("undefined"===e||"boolean"===e)&&(c="boolean"===e?b:!1,b=a,a=this),"object"!=typeof b&&"[object Function]"!==Object.prototype.toString.call(b)&&(b={});2>=f;){if(d=1===f?a:b,null!==d)for(var g in d){var h=a[g],i=d[g];a!==i&&(c&&i&&"object"==typeof i&&!i.nodeType?a[g]=this.extend(h||(null!==i.length?[]:{}),i,c):void 0!==i&&(a[g]=i))}f++}return a}},b.Ajax.getArticleLimit=function(){var a=this;a.updateArticleLimit()},b.Ajax.getGallery=function(c,d){b.Dialog.gallery("loading",c);var e=d||b.URL_AJAX_GET_GALLERY;a.ajax({url:e,data:{ge_target:c},timeout:5e3,dataType:"jsonp",success:function(a){if(!a||"100"!==a.code)return void b.Dialog.gallery("error",c);if(0===a.total)b.Dialog.gallery("empty",c);else{var d=a.data;b.Dialog.gallery("content",c,d)}},error:function(){b.Dialog.gallery("error",c)},complete:function(a,d){"timeout"===d&&b.Dialog.gallery("error",c)}})},b.Ajax.loadDraft=function(){if("undefined"!=typeof draft_article){if(null===draft_article)return;return b.data_draft=[],b.data_draft.push(draft_article),void b.updateDraft()}var c=b.config.domain+b.URL_AJAX_GET_DRAFT;a.ajax({url:c,type:"post",dataType:"jsonp",success:function(a){return a&&"100"===a.code?(b.data_draft=a.data,void b.updateDraft()):void(b.data_draft=null)},error:function(){b.Util.log.error("获取草稿失败！")}})},b.Ajax.sendPublish=function(){var c=this,d="",e="",f="";for(var g in c.instances)"count"!==g&&(d+=c.instances[g].data.articleId+"-|||-",e+=c.instances[g].data.cover+"-|||-",f+=c.instances[g].data.title+"-|||-");c.Dialog.uploading("发布中..."),a.ajax({url:c.URL_AJAX_PUBLISH,timeout:1e4,data:{article_id_string:d,article_title_string:f,article_cover_string:e,article_num:c.instances.count},type:"post",
dataType:"jsonp",complete:function(a,c){"timeout"===c&&b.Dialog.error("请求超时")},error:function(){c.dialog_uploading.hide(),b.Dialog.error("网络故障！")},success:function(a){if(c.dialog_uploading.hide(),!a)return void b.Dialog.error("发布失败");a.data;return"100"!==a.code?void c.Dialog.error(a.msg):(c.isBindUnload=!1,void c.Dialog.success("发布成功,正在跳转...",a.data&&a.data.url||b.config.domain+"/u/pushmanage"))}})},b.Handler.afterUploadCV=function(a,c){if(b.dialog_uploading&&b.dialog_uploading.hide(),c&&a&&a!==b.FAKE_ID){var d=b.instances[a];d.res_status.uploadCV=!0,"100"===c.code?(d.$cover_preview_img.attr("src",c.data),d.$cover_preview_box.show(),c.data&&""!==c.data?(d.data.cover=c.data,d.status.cover=1,d.UI.articlelist.updateCover.call(d),d.$cover_error.hide()):d.status.cover=""):"001"===c.code?b.Dialog.error("图片尺寸过大"):b.Dialog.error("上传失败"),d.autosave()}},b.Handler.afterUploadGE=function(c,d){return b.res_status.uploadGE=!0,d&&"100"===d.code?(b.res_status.uploadGE=!0,d.imgid&&("editor"===d.type?b.checked_id.length>=b.MAX_COUNT_GALLERY_CHECKED&&b.checked_id.splice(0,1):"cover"===d.type&&0!==b.checked_id.length&&(b.checked_id=[]),b.checked_id.push(d.imgid),b.checked_img[d.imgid]={src:d.data,w:d.width,h:d.height}),void(d.isfromgallery&&b.Ajax.getGallery(d.type))):(a("#qWindowBox_yegallery .yegallery_gallery_item-fake .thumb_img").attr("src","/u/img/ykeditor/upload-error.jpg"),void a("#qWindowBox_yegallery .yegallery_gallery_item-fake .entry_name").css("color","#f00"))},b.Dialog={clear:function(){},clearAll:function(){a(".ye_qwindow").hide(),a(".ye_qwindow_mask").hide()},cover:function(){if(!b.dialog_cover){var c="";c+="<div class='ye_qmask'>",c+="<div class='ye_qmask_cover'></div>",c+="<i class='ye_loading-64'></i>",c+="</div>",a("body").append(a(c)),b.dialog_cover=a(".ye_qmask")}b.dialog_cover.css({width:document.documentElement.scrollWidth||document.body.scrollWidth,height:document.documentElement.scrollHeight||document.body.scrollHeight}).show()},error:function(a,c){var d={width:200,height:90};c&&(d.width=c.width||200,d.height=c.height||90),b.dialog_error||(b.dialog_error=new b.Util.Qwindow({posrefer:window,showhandle:!0,showmask:!0,elements:"",maskstyle:{color:"#000",opacity:.5}}));var e=['<div class="errorBox" >','<div class="errorBox-msg clearfix">','<span class="ye_icon ye_icon_error"></span>',a,"</div>","</div>"];b.dialog_error.setContent("html",e.join("")),b.dialog_error.setSize(d.width,d.height),b.dialog_error.show(),setTimeout(function(){b.dialog_error.hide()},1500)},warning:function(a){b.dialog_warning||(b.dialog_warning=new b.Util.Qwindow({size:{width:200,height:120},posrefer:window,showhandle:!0,showmask:!0,elements:"",maskstyle:{color:"#000",opacity:.5}}));var c=['<div class="warnBox" >','<div class="warnBox-msg clearfix">','<span class="ye_icon ye_icon_warn"></span>',a,"</div>","</div>"];b.dialog_warning.setContent("html",c.join("")),b.dialog_warning.setSize(200,90),b.dialog_warning.show(),setTimeout(function(){b.dialog_warning.hide()},5e3)},success:function(a,c){var d=1500,e=new b.Util.Qwindow({size:{width:200,height:80},posrefer:window,showhandle:!0,showmask:!0,elements:"",maskstyle:{color:"#000",opacity:.5}}),f=['<div class="ye_finishBox">','<div class="ye_finishBox-msg clearfix">','<span class="ye_icon ye_icon_finish"></span>','<span class="ye_finish_text">'+a+"</span>","</div>","</div>"];e.setContent("html",f.join("")),e.show(),setTimeout(function(){e.hide(),c&&(window.location.href=c)},d)},uploading:function(a){b.dialog_uploading||(b.dialog_uploading=new b.Util.Qwindow({size:{width:200,height:120},posrefer:window,showhandle:!1,showmask:!0,elements:"",maskstyle:{color:"#000",opacity:.5}}));var c=a||"上传中…",d=['<div class="loadingBox" id="loadingBox">','<div class="loadingBox-msg clearfix">',"<span>"+c+"</span>","</div>",'<div class="loadingBox-btn"><img src="'+b.config.domain+'/u/img/pushRM/loading_64.gif" width="32"></div>',"</div>"];b.dialog_uploading.setContent("html",d.join("")),b.dialog_uploading.show()},confirm:function(c,d,e){function f(){k.on("click",function(){i.hide(),"function"==typeof d&&d()}),l.on("clic
k",function(){i.hide()})}var g=e&&e.width||200,h=e&&e.height||120,i=new b.Util.Qwindow({size:{width:g,height:h},posrefer:window,showhandle:!0,showmask:!0,elements:"",maskstyle:{color:"#000",opacity:.5}}),j=['<div class="ye_dialog_confirm">','<div class="ye_dialog_confirm_msg clearfix">','<span class="ye_icon ye_icon_alert"></span>','<span class="ye_confirm_text">'+c+"</span>","</div>",'<div class="ye_dialog_confirm_btn"><div class="ye_btn ye_btn_s"><span class="ye_btn_text" _cf_for="ok" >确定</span></div> <div class="ye_btn ye_btn_s ye_btn_grey"><span class="ye_btn_text" _cf_for="cancel">取消</span></div></div>',"</div>"];i.setContent("html",j.join("")),i.show();var k=a(i.dom.winbody).find('[_cf_for="ok"]'),l=a(i.dom.winbody).find('[_cf_for="cancel"]');f()},preview:function(a,c,d){b.dialog_preview||(b.dialog_preview=new b.Util.Qwindow({size:{width:830,height:590},scrolling:!1,showhandle:!0,showmask:!0,pos:{top:"top",left:"center"},maskstyle:{color:"#000",opacity:.5}}));var e=['<div class="qWindowBox qWindowBox_ye" id="qWindowBox_yepreview">','<div class="qWindowBox_yepreview_head">广播预览</div>','<div class="qWindowBox_yepreview_body">','<div class="preview_qcode">','<h4 class="preview_qcode_hint">手机扫描二维码预览</h4>','<div class="preview_qcode_thumb">','<img class="preview_qcode_img" src="'+a+'">','<div class="preview_qcode_cover">','<i class="ye_icon_refresh"></i>',"</div>","</div>","</div>",'<div class="preview_page">','<p class="preview_page_title">'+c+"</p>",'<iframe class="preview_page_iframe" frameborder="0" scrolling="auto" src="'+d+'"></iframe>',"</div>","</div>","</div>"].join("");b.dialog_preview.setContent("html",e),b.dialog_preview.show()},uploadQW:function(a){b.dialog_uploadQW&&b.dialog_uploadQW.destroy();var c=b.config.domain+b.URL_UPLOAD_IMG+"?push_upload_type=editor&callback=parent.YE.Handler.afterUploadQW&ykeditor_id="+a;b.dialog_uploadQW=new b.Util.Qwindow({size:{width:200,height:120},posrefer:window,showhandle:!0,showmask:!0,elements:"",maskstyle:{color:"#000",opacity:.5}});var d="upload_iframe_"+(new Date).getTime(),e=['<div class="selectImageBox" id="selectImageBox">','<div class="selectImageBox-msg clearfix">',"<span>请选择图片</span>","</div>",'<div class="selectImageBox-btn">','<iframe name="'+d+'" style="display:none;"></iframe>','<form method="post" id="qw_upimg_form" enctype="multipart/form-data" target="'+d+'" action="'+c+'">','<div class="ye_btn ye_btn_s ye_btnmaj_s" ><span class="ye_btn_text">浏览</span></div>','<input type="file" name="upfile" class="upfile" style="position:absolute;opacity:0;filter: alpha(opacity=0);z-index:999;left:72px;top:65px;width:57px;height:24px;" onchange="YE.Handler.onUploadQW(this,'+a+')">',"</form>","</div>","</div>"].join("");b.dialog_uploadQW.setContent("html",e),b.dialog_uploadQW.show()},uploadQW_error:function(a,c){var d="",e=b.config.domain+b.URL_UPLOAD_IMG+"?push_upload_type=editor&callback=parent.YE.Handler.afterUploadQW&ykeditor_id="+a;b.dialog_uploadQW_error||(b.dialog_uploadQW_error=new b.Util.Qwindow({size:{width:200,height:120},posrefer:window,showhandle:!0,showmask:!0,elements:"",maskstyle:{color:"#000",opacity:.5}})),d="upload_iframe_"+(new Date).getTime();var f='<div class="uploadQW_errorBox">';f+='<div class="uploadQW_errorBox-msg clearfix">',f+='<span class="ye_icon ye_icon_error"></span>',f+=c,f+="</div>",f+='<div class="uploadQW_errorBox-btn">',f+='<div class="ye_btn ye_btn_s ye_btnmaj_s">',f+='<span class="ye_btn_text">',f+="重新上传图片",f+="</span>",f+='<iframe name="'+d+'" style="display:none;"></iframe>',f+='<form method="post" enctype="multipart/form-data" target="'+d+'" action="'+e+'">',f+='<input type="file" name="upfile" class="upfile" onchange="YE.Handler.onUploadQW(this,'+a+')">',f+="</form>",f+="</div>",f+="</div>",f+="</div>",b.dialog_uploadQW_error.setContent("html",f),b.dialog_uploadQW_error.show()},gallery:function(a,c,d){var e=a||"loading",f=c||"editor",g="",h=b.config.domain+b.URL_UPLOAD_IMG+"?callback=parent.YE.Handler.afterUploadGE&ykeditor_id="+b.FAKE_ID+"&isfromgallery=true",i="cover"===f?1:b.MAX_COUNT_GALLERY_CHECKED,j=b.checked_id&&b.checked_i
d.length||0;switch(b.dialog_gallery||(b.dialog_gallery=new b.Util.Qwindow({size:{width:830,height:590},posrefer:window,showhandle:!0,showmask:!0,elements:"",maskstyle:{color:"#000",opacity:.5},onhide:function(){b.checked_id=[]}})),"cover"===f?h+="&push_upload_type=cover":"editor"===f&&(h+="&push_upload_type=editor"),e){case"empty":g=['<div class="yegallery_gallery_empty" style="display:block">','<i class="ye_icon ye_icon_notice_blue"></i>','<p class="yegallery_gallery_empty_hint">没有图片，请<span class="yegallery_gallery_empty_act">本地上传</span>图片</p>','<form method="post" enctype="multipart/form-data" action="'+h+'" target="yegallery_upload_iframe" id="yegallery_upload_form_empty">','<input type="file" name="upfile" class="yegallery_upload_file yegallery_upload_file_empty">',"</form>","</div>",'<div class="yegallery_gallery_box">','<ul class="yegallery_gallery_list clearfix">',"</ul>","</div>"].join("");break;case"error":g=['<div class="yegallery_gallery_error" style="display:block">','<i class="ye_icon ye_icon_error"></i>','<p class="yegallery_gallery_error_hint">加载失败，请检查网络状况或<span class="yegallery_gallery_error_act">刷新</span></p>',"</div>"].join("");break;case"content":g=d;break;case"loading":g=['<div class="yegallery_gallery_loading" style="display:block;">','<i class="ye_loading-64"></i>',"</div>"].join("")}var k=['<div class="qWindowBox" id="qWindowBox_yegallery">','<div class="qWindowBox_yegallery_head">从图片库选择</div>','<div class="qWindowBox_yegallery_body">','<div class="yegallery_upload">',"<span>建议尺寸：640 x 360 px</span>",'<div class="ye_btn yegallery_upload_btn">','<span class="ye_btn_text">本地上传</span>','<iframe name="yegallery_upload_iframe" style="display:none;"></iframe>','<form method="post" enctype="multipart/form-data" action="'+h+'" target="yegallery_upload_iframe" id="yegallery_upload_form">','<input type="file" name="upfile" class="yegallery_upload_file">',"</form>","</div>","</div>",'<div class="yegallery_gallery">',g,"</div>",'<div class="qWindowBox_yegallery_act">','<span class="qWindowBox_yegallery_slectedsum">已选'+j+"个，可选"+i+"个</span>",'<div class="ye_btn ye_btn_l ye_btnmaj_l qWindowBox_yegallery_act_btn ye_btn-disable">','<span class="ye_btn_text" _for="add">完成</span>',"</div>","</div>","</div>","</div>"].join("");b.dialog_gallery.setContent("html",k),b.dialog_gallery.target=f,b.dialog_gallery.show(),"content"===a&&b.updateGallery(f)}};var c=function(c,d,e,f){var g=this;return g.isComplete=!1,g.active=!0,g.status={title:0,summary:0,cover:0,content:0,donateTitle:1,donateFlag:1},g.isAbleToPush=!1,this.timestamp=c,this.id="ykeditor_"+this.timestamp,this.opt=a.extend(d,{timeout_uploadCV:5e3}),this.data={articleId:"",donateId:"",title:"",cover:"",summary:"",content:"",open_comment:"1",open_donate:"0",donateTitle:"视频创作不容易，打个赏支持下吧",donateFlag:"感谢对我的赞助支持，你将出现在我的作品中，伴随我的创作"},this.content_html_length=0,this.content_text_length=0,this.res_status={uploadCV:!1,uploadQW:!1},this.editor_id=this.UI.render(c,d),this.UI.editor.restoreSize(this.editor_id),this.editor_opts=this.opt&&this.opt.editor&&b.Util.mapOpts(d.editor),this.ueditor=UE.getEditor(this.editor_id,this.editor_opts),this.ueditor.ready(function(){g.selectAll(),g.updateLimitStatus(),g.isComplete=!0,f&&g.disable(),e&&"undefined"!=typeof e&&g.updateDraft(e),g.UI.editor.restyle.call(g),g.UI.restyle.call(g),g.UI.editor.doFixToolbar.call(g),g.bind()}),this};return c.prototype.UI={},c.prototype.Ajax={},c.prototype.selectAll=function(){this.$container=a("#"+this.id),this.$section_left=this.$container.find(".ye_section_left"),this.$articlelist_box=this.$section_left.find(".ye_box_articlelist"),this.$articlelist_title=this.$articlelist_box.find(".ye_articlelist_title"),this.$articlelist_img=this.$articlelist_box.find(".yk_img_article"),this.$section_right=this.$container.find(".ye_section_right"),this.$title_box=this.$section_right.find(".ye_box_title"),this.$title_input=this.$title_box.find(".ye_input_title"),this.$title_count=this.$title_box.find(".ye_input_num_count"),this.$title_error=this.$title_box.find(".ye_error"),this.$summary_box=this.$section_right.find(".ye_
box_summary"),this.$summary_input=this.$summary_box.find(".ye_input_area_summary"),this.$summary_count=this.$summary_box.find(".ye_area_num_count"),this.$summary_error=this.$summary_box.find(".ye_error"),this.$cover_box=this.$section_right.find(".ye_box_cover"),this.$cover_form=this.$cover_box.find(".ye_upload_cover_form"),this.$cover_input=this.$cover_box.find(".ye_upfile"),this.$cover_error=this.$cover_box.find(".ye_error"),this.$cover_preview_box=this.$cover_box.find(".ye_cover_preview"),this.$cover_preview_img=this.$cover_preview_box.find(".ye_cover_mini"),this.$cover_delete=this.$cover_preview_box.find(".ye_act_delete_cover"),this.$cover_btn_gallery=this.$cover_box.find(".ye_cover_gallery"),this.$editor_box=this.$section_right.find(".ye_box_editor"),this.$editor_subtitle=this.$editor_box.find(".ye_subtitle_autosave"),this.$editor_ue=this.$editor_box.find(".edui-editor"),this.$editor_toolbar=this.$editor_box.find(".edui-editor-toolbarbox"),this.$editor_iframe=this.$editor_box.find(".edui-editor-iframeholder"),this.$editor_error=this.$editor_box.find(".ye_error"),this.$opencomment_box=this.$section_right.find(".ye_box_opencomment"),this.$opencomment=this.$opencomment_box.find(".ye_checkbox_opencomment"),this.$donate_box=this.$section_right.find(".ye_box_donate"),this.$donate_checkbox=this.$donate_box.find(".ye_checkbox_opendonate"),this.$donate_input_title=this.$donate_box.find(".ye_input_donatetitle"),this.$donate_input_flag=this.$donate_box.find(".ye_input_area_donateflag"),this.$donate_count_title=this.$donate_box.find(".donate_item_title .ye_input_num_count"),this.$donate_count_flag=this.$donate_box.find(".donate_item_flag .ye_input_num_count"),this.$donate_contentbox=this.$donate_box.find(".ye_box_contentbox"),this.$donate_hint_title=this.$donate_box.find(".ye_hint_donatetitle"),this.$donate_hint_flag=this.$donate_box.find(".ye_hint_donateflag"),this.$donate_error_title=this.$donate_box.find(".ye_error_donatetitle"),this.$donate_error_flag=this.$donate_box.find(".ye_error_donateflag"),this.$submit_box=this.$section_right.find(".ye_box_submit"),this.$submit_btn=this.$submit_box.find(".ye_btn"),this.$submit_status=this.$submit_box.find(".ye_status_submit")},c.prototype.checkAbleToPost=function(a){if(!a||""===a)return!1;var b=this,c=!1;switch(a){case"autosave":c=0!==b.status.title||0!==b.status.cover||0!==b.status.content||0!==b.status.summary?!0:!1;break;case"manual":case"preview":case"publish":c=1!==b.status.title||1!==b.status.cover||1!==b.status.content||1!==b.status.summary?!1:!0}return c},c.prototype.checkErrors=function(){function a(){switch(f.status.title){case 0:f.$title_count.removeClass("c_red"),f.$title_error.html("请填写标题").show(),f.$title_input.addClass("ye_input-error");break;case 1:f.$title_error.hide(),f.$title_input.removeClass("ye_input-error"),f.$title_count.removeClass("c_red");break;case 2:f.$title_count.addClass("c_red"),f.$title_error.html("标题不能超过"+b.MAX_COUNT_TITLE+"字").show(),f.$title_input.addClass("ye_input-error")}}function c(){switch(f.status.cover){case 0:f.$cover_error.show();break;case 1:f.$cover_error.hide()}}function d(){switch(f.status.content){case 0:f.$editor_error.html("请填写正文").show();break;case 1:f.$editor_error.hide();break;case 2:f.$editor_error.html("正文字数多于"+b.MAX_COUNT_CONTENT+"字").show()}}function e(){switch(f.status.summary){case 0:f.$summary_count.addClass("c_red"),f.$summary_error.html("推荐理由不能为空").show(),f.$summary_input.addClass("ye_input-error");break;case 1:f.$summary_error.hide(),f.$summary_input.removeClass("ye_input-error"),f.$summary_count.removeClass("c_red");break;case 2:f.$summary_count.addClass("c_red"),f.$summary_error.html("推荐理由不能超过"+b.MAX_COUNT_SUMMARY+"字").show(),f.$summary_input.addClass("ye_input-error")}}var f=this;a(),e(),c(),d(),f.UI.restyle.call(f)},c.prototype.disable=function(){this.$container.addClass("ykeditor-disable"),this.active=!1},c.prototype.enable=function(){for(var a in b.instances)"count"!==a&&b.instances[a].disable();this.$container.removeClass("ykeditor-disable"),this.active=!0},c.prototype.updateDraft=function(a){var b=this,c=function
(){b.data.title&&(b.$title_input.val(b.data.title),b.$articlelist_title.val(b.data.title),b.$title_input.trigger("keyup"))},d=function(){b.data.summary&&(b.$summary_input.val(b.data.summary),b.$summary_input.trigger("keyup"))},e=function(){b.data.cover&&(b.status.cover=1,b.$cover_preview_img.attr("src",b.data.cover),b.$cover_preview_box.show(),b.$articlelist_img.attr("src",b.data.cover))},f=function(){b.ueditor.setContent(b.data.content,!1)},g=function(){"1"===b.data.open_comment||1===b.data.open_comment?b.$opencomment[0].checked=!0:b.$opencomment[0].checked=!1};b.data.title=a.title,b.data.summary=a.summary,b.data.cover=a.picture,b.data.content=a.content,b.data.articleId=a.id,b.data.open_comment=a.open_comment,c(),d(),e(),f(),g()},c.prototype.autosave=function(a){var b=this;if(b.enable){var c=a||"auto",d=!1;switch(c){case"auto":d=b.checkAbleToPost("autosave"),d&&b.Ajax.sendArticle.call(b,"autosave");break;case"manual":d=b.checkAbleToPost("manual"),d?b.Ajax.sendArticle.call(b,"manual"):b.showErrors()}}},c.prototype.updateDonateId=function(){var c=this,d=a("<div>"+c.ueditor.getContent()+"</div>"),e=d.find(".donateBox_fake");if("0"===c.data.open_donate)return e.remove(),c.ueditor.setContent(d.html()),void(b.dialog_cover&&b.dialog_cover.hide());if(0!==e.length)e.html("[yk_donate]"+c.data.donateId+"[/yk_donate]"),c.ueditor.setContent(d.html());else{var f="<div><span class='donateBox_fake' style='display:none;'>[yk_donate]"+c.data.donateId+"[/yk_donate]</span></div>";c.ueditor.execCommand("inserthtml",f)}b.dialog_cover.hide()},c.prototype.updateLimitStatus=function(){var a=this;if(b.limitStatus.enableComment)try{a.$opencomment_box.show(),a.data.open_comment="1",a.$opencomment[0].checked=!0}catch(c){}else a.$opencomment_box.hide(),a.data.open_comment="0",a.$opencomment[0].checked=!1;if(b.limitStatus.enableDonate)try{a.data.open_donate="1",a.$donate_box.show().addClass("ye_box_donate-open"),a.$donate_checkbox[0].checked=!0,a.$donate_input_title.val(a.data.donateTitle),a.$donate_input_flag.val(a.data.donateFlag)}catch(c){}else a.data.open_donate="0",a.$donate_box.hide(),a.$donate_checkbox[0].checked=!1},c.prototype.showErrors=function(){var a=this;switch(a.enable(),a.checkErrors(),!0){case 0===a.status.title:b.Dialog.error("请填写标题");break;case 2===a.status.title:b.Dialog.error("标题字数请控制在"+b.MAX_COUNT_TITLE+"字以内",{width:270});break;case 0===a.status.summary:b.Dialog.error("请填写推荐理由");break;case 2===a.status.summary:b.Dialog.error("推荐理由字数请控制在"+b.MAX_COUNT_SUMMARY+"字以内",{width:300});break;case 0===a.status.cover:b.Dialog.error("请上传封面");break;case 0===a.status.content:b.Dialog.error("请填写正文");break;case 2===a.status.content:b.Dialog.error("正文字数请控制在"+b.MAX_COUNT_CONTENT+"字以内",{width:300})}},c.prototype.UI={render:function(c,d){var e=d||{},f=["<div class='ykeditor clearfix' id = 'ykeditor_"+c+"'>"],g=["<div class='ye_box ye_box_editarea clearfix'>"],h=["<div class='ye_section ye_section_left clearfix'>"],i=["<div class='ye_section ye_section_right clearfix'><ul class='ye_ul'>"],j="editor_"+b.id+"_"+c;if(!e.articlelist){var k=this.articlelist.render();h.push(k)}if(!e.title){var l=this.title.render();i.push(l)}if(!e.summary){var m=this.summary.render();i.push(m)}if(!e.cover){var n=this.cover.render(j);i.push(n)}var o=this.editor.render(j);if(i.push(o),!e.opencomment){var p=this.opencomment.render();i.push(p)}if(!e.donate){var q=this.donate.render();i.push(q)}return i.push("</ul></div>"),i=i.join(""),h.push("</div>"),h=h.join(""),g.push(h),g.push(i),g.push("</div>"),g=g.join(""),f.push(g),f.push("</div>"),f=f.join(""),b.$container.append(a(f)),j},restyle:function(){}},c.prototype.UI.articlelist={render:function(){var a="";return a+="<div class='ye_box ye_box_articlelist'>",a+="<div class='ye_body_entry'>",a+="<p class='ye_articlelist_title'>请填写标题</p>",a+="<div class='ye_articllist_info'>",a+="<span class='ye_icon ye_icon_readnum'></span>阅读数",a+="<span class='ye_icon ye_icon_commentnum'></span>评论数",a+="</div>",a+="</div>",a+="<div class='ye_body_image'>",a+="<div class='ye_cover ye_cover_img'>",a+="<div class='ye_act ye_act_editA'>",a+="<i cla
ss = 'ye_icon ye_icon_editA'></i>",a+="</div>",a+="<div class='ye_act ye_act_delA'>",a+="<i class = 'ye_icon ye_icon_delA'></i>",a+="</div>",a+="</div>",a+="<img class='yk_img yk_img_article' src="+b.config.emptyCV+">",a+="</div>",a+="</div>",a+="<div class='ye_cover ye_cover_add' >+</div>"},updateTitle:function(){var a=this;a.data&&""!==a.data.title?this.$articlelist_title.html(a.data.title):this.$articlelist_title.html("请填写标题")},updateCover:function(){var a=this;a.data&&a.data.cover&&""!==a.data.cover?this.$articlelist_img.attr("src",a.data.cover):this.$articlelist_img.attr("src",b.config.emptyCV)}},c.prototype.UI.cover={render:function(a){var b="";return b+="<li class='ye_li ye_box ye_box_cover'>",b+="<div class='ye_head ye_head_cover'>封面<span class='ye_subtitle colorGrey f_12 ml8'>图片最大不可超过5M，建议尺寸640像素*360像素</span></div>",b+="<div class='ye_body ye_body_cover'>",b+="<div class='ye_cover_upload  ye_btn ye_btn_middle ye_btnsub_middle'>",b+="<span class='ye_btn_text'>上传图片</span>",b+="<iframe name='ye_upload_cover_target_"+a+"' style='display:none;'></iframe>",b+="<form action='' target='ye_upload_cover_target_"+a+"' method='post' enctype='multipart/form-data' class='ye_upload_cover_form' id='ye_upload_cover_form_"+a+"'>",b+="<input type='file' name='upfile' class='ye_upfile' >",b+="</form>",b+="</div>",b+="<div class='ye_cover_gallery  ye_btn ye_btn_middle ye_btnsub_middle'>",b+="<span class='ye_btn_text'>从图片库选择</span>",b+="</div>",b+="<div class='ye_error' >请上传封面</div>",b+="<div class='ye_cover_preview'>",b+="<img src= '' class='ye_cover_mini'>",b+="<span class='ml8 ye_act ye_act_delete_cover'>删除</span>",b+="</div>",b+="</div>",b+="</li>"}},c.prototype.UI.donate={render:function(){var a="";return a+="<li class='ye_li ye_box ye_box_donate'>",a+="<div class='ye_body ye_body_donate'>",a+="<div class='ye_donate_act f_12 mb8'>",a+="<input type='checkbox' class='ye_checkbox ye_checkbox_opendonate'>",a+="开启观众赏赐<i class='ye_icon ye_icon_tag_new'></i><span class = 'ye_subtitle colorGrey f_12 lh_12 ml20 ye_hint_donate'>暂不支持预览</span></div>",a+="<div class = 'ye_box ye_box_contentbox'>",a+="<div class = 'donate_item donate_item_title mb20'>",a+="<h3 class='f_14 lh_14 mb10'>求赏赐标题<span class = 'ye_subtitle colorGrey f_12 lh_12 ml8'>观众会在赏赐前看到这段文字</span></h3>",a+="<div class='content mb8'>",a+="<div class='ye_input_num_count'>0/"+b.MAX_COUNT_DONATETITLE+"</div>",a+="<input class='ye_input ye_input_donatetitle' >",a+="<p class = 'ye_hint ye_hint_donatetitle colorGrey f_12 lh_12' style='display:none;'>视频创作不容易，打个赏支持下吧</p>",a+="</div>",a+="<p class='ye_error ye_error_donatetitle'>不能超过"+b.MAX_COUNT_DONATETITLE+"字</p>",a+="</div>",a+="<div class = 'donate_item donate_item_flag'>",a+="<h3 class='f_14 lh_14 mb10'>感谢语<span class = 'ye_subtitle colorGrey f_12 lh_12 ml8'>观众赏赐后，会看到这段文字</span></h3>",a+="<div class='content mb8'>",a+="<div class='ye_input_num_count'>0/"+b.MAX_COUNT_DONATEFLAG+"</div>",a+="<textarea class='ye_input ye_input_area ye_input_area_donateflag'></textarea>",a+="<p class = 'ye_hint ye_hint_donateflag colorGrey f_12 lh_12' style='display:none;'>感谢对我的赞助支持，你将出现在我的作品中，伴随我的创作</p>",a+="</div>",a+="<p class='ye_error ye_error_donateflag'>不能超过"+b.MAX_COUNT_DONATEFLAG+"字</p>",a+="</div>",a+="<a class='ye_donate_proxy' href='http://c.youku.com/agreement' target='_blank'>优酷道长赏赐使用协议</a>",a+="</div>",a+="</div>",a+="</li>"}},c.prototype.UI.editor={render:function(a){var b="";return b+="<li class='ye_li ye_box ye_box_editor'>",b+="<div class='ye_editor' style = 'width:100%;'>",b+="<div class='ye_head ye_head_editor'>正文",b+="<span class='ye_subtitle colorGrey ml8 ye_subtitle_autosave'>已自动保存</span>",b+="</div>",b+="<div class='ye_body ye_body_editor' id='"+a+"' style='width:100%;'></div>",b+="<div class='ye_error c_red'>请填写正文</div>",b+="</div>",b+="</li>"},restoreSize:function(c){if(c&&b.REG_CHAR.test(c)){var d=a("#"+c),e=d.width(),f=b.opt.height||b.config.editor.height;d.width(e-2),d.height(f)}},restyle:function(){var b=this.$editor_ue,c=this.$editor_toolbar,d=a(".edui-for-yeimage").parent(".edui-toolbar"),e=a(".edui-for-fontsize").parent(
".edui-toolbar");b.addClass("ye_editor_ue"),c.addClass("ye_editor_toolbar"),d.css({position:"absolute",top:0,left:0,width:"100%",padding:"3px 0 0 3px",boxSizing:"border-box",borderBottom:"solid 1px #fff",height:"31px"}),e.css({position:"absolute",top:"32px",left:"5px",height:"30px",boxSizing:"border-box",paddingTop:"4px"})},doFixToolbar:function(){function c(a){var b,c=document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop,f=document.documentElement&&document.documentElement.scrollLeft||document.body.scrollLeft,k=i.css("width").split("px")[0];e=parseInt(i.css("height").split("px")[0])+2,l=i.offset(),d=parseInt(j.css("height").split("px")[0]);var n=l.top+e-m-d;g&&(b=c+h>n?n-c:h,c+=h),c>l.top?j.css({position:"fixed",border:"1px solid #CCCCCC",width:k-10+"px",top:b+"px",left:l.left-f+"px",zIndex:1e3}):j.css({position:"static",border:"none",width:"auto",borderBottom:"1px solid #CCCCCC"})}var d,e,f=this,g=b.opt.ISHEADERFIXED,h=b.opt.HEIGHT_HEADER,i=this.$editor_ue,j=this.$editor_toolbar,k=f.$editor_iframe[0].contentWindow,l=i.offset(),m=0;c(),a(window).on("scroll resize",c),a(k).on("resize",c)}},c.prototype.UI.opencomment={render:function(){var a="";return a+="<li class='ye_li ye_box ye_box_opencomment'>",a+="<div class='ye_body ye_body_opencomment'>",a+="<span class='f_12'>",a+="<input type='checkbox' class='ye_checkbox ye_checkbox_opencomment'>",a+="开启评论模块</span>",a+="</div>",a+="</li>"}},c.prototype.UI.summary={render:function(){var a="";return a+="<li class='ye_li ye_box ye_box_summary'>",a+="<div class='ye_head ye_head_summary'>推荐理由",a+="<span class='ye_subtitle colorGrey ml8'>好的推荐理由可以带来更多的观看</span>",a+="</div>",a+="<div class='ye_body ye_body_summary'>",a+="<div class='ye_area_num_count'>0/40</div>",a+="<textarea type='text' class='ye_input ye_input_area ye_input_area_summary'></textarea>",a+="</div>",a+="<div class='ye_error' >推荐理由不能超过40字</div>",a+="</li>"}},c.prototype.UI.title={render:function(){var a="";return a+="<li class='ye_li ye_box ye_box_title'>",a+="<div class='ye_head ye_head_title'>标题</div>",a+="<div class='ye_body ye_body_title'>",a+="<div class='ye_input_num_count'>0/"+b.MAX_COUNT_TITLE+"</div>",a+="<input type='text' class='ye_input ye_input_title'>",a+="</div>",a+="<div class='ye_error' >请填写标题</div>",a+="</li>"}},c.prototype.bind=function(){this.bind_articlelist(),this.bind_title(),this.bind_summary(),this.bind_cover(),this.bind_editor(),this.bind_opencomment(),this.bind_donate()},c.prototype.bind_articlelist=function(){var a=this;this.$articlelist_box.on("click",".ye_cover_img .ye_act_editA",function(){b.saveActive(),b.disableAll(),a.enable()}).on("click",".ye_cover_img .ye_act_delA",function(){a.Ajax.deleteArticle.call(a)})},c.prototype.bind_cover=function(){function a(){var a=f.$cover_input.val(),b=/\.[^\.]+$/.exec(a)[0];return b=b.toLowerCase(),".png"!=b&&".jpg"!=b&&".jpeg"!=b&&".gif"!=b?!1:!0}function c(){var c=a();if(c){f.$cover_form.submit(),b.Dialog.uploading(),f.$cover_input.replaceWith(f.$cover_input=f.$cover_input.clone(!0));var d=setTimeout(function(){b.dialog_uploading.hide(),f.res_status.uploadCV?clearTimeout(d):b.Dialog.error("上传超时")},5e3)}else b.Dialog.error("图片格式错误");f.UI.restyle.call(f)}function d(){f.data.cover="",f.isCoverReady=!1,f.$cover_preview_box.hide(),f.$cover_preview_img.attr("src",""),f.status.cover=0,
f.UI.articlelist.updateCover.call(f),f.$cover_error.show(),f.UI.restyle.call(f),f.autosave.call(f)}function e(){b.Ajax.getGallery("cover")}var f=this;f.$cover_form.attr("action",b.config.domain+b.URL_UPLOAD_IMG+"?push_upload_type=cover&callback=parent.YE.Handler.afterUploadCV&ykeditor_id="+f.timestamp),f.$cover_input.on("change",c),f.$cover_delete.on("click",d),this.$cover_btn_gallery.on("click",e)},c.prototype.bind_donate=function(){function c(){f.$donate_checkbox[0].checked?(f.data.open_donate="1",f.$donate_box.addClass("ye_box_donate-open"),f.$donate_input_title.val(f.data.donateTitle),f.$donate_input_flag.val(f.data.donateFlag),d(),e()):(f.data.open_donate="0",f.$donate_box.removeClass("ye_box_donate-open"),f.updateDonateId())}function d(){var c=a.trim(f.$donate_input_title.val()),d=b.Util.textfilter(c,"script");""!==d&&(f.$donate_input_title.val(d),c=d);var e=c.length;f.data.donateTitle=c,f.$donate_count_title.html(e+"/"+b.MAX_COUNT_DONATETITLE),e>b.MAX_COUNT_DONATETITLE?(f.status.donateTitle=2,f.$donate_error_title.html("不能超过"+b.MAX_COUNT_DONATETITLE+"字").show(),f.$donate_input_title.addClass("ye_input-error"),f.$donate_count_title.addClass("c_red")):0===e?(f.status.donateTitle=0,f.$donate_error_title.hide(),f.$donate_input_title.removeClass("ye_input-error"),f.$donate_count_title.removeClass("c_red")):(f.status.donateTitle=1,f.$donate_error_title.hide(),f.$donate_input_title.removeClass("ye_input-error"),f.$donate_count_title.removeClass("c_red"))}function e(){var c=a.trim(f.$donate_input_flag.val()),d=b.Util.textfilter(c,"script");""!==d&&(f.$donate_input_flag.val(d),c=d);var e=c.length;f.data.donateFlag=c,f.$donate_count_flag.html(e+"/"+b.MAX_COUNT_DONATEFLAG),e>b.MAX_COUNT_DONATEFLAG?(f.status.donateFlag=2,f.$donate_error_flag.html("不能超过"+b.MAX_COUNT_DONATEFLAG+"字").show(),f.$donate_input_flag.addClass("ye_input-error"),f.$donate_count_flag.addClass("c_red")):0===e?(f.status.donateFlag=0,f.$donate_error_flag.hide(),f.$donate_input_flag.removeClass("ye_input-error"),f.$donate_count_flag.removeClass("c_red")):(f.status.donateFlag=1,f.$donate_error_flag.hide(),f.$donate_input_flag.removeClass("ye_input-error"),f.$donate_count_flag.removeClass("c_red"))}var f=this;f.$donate_checkbox.on("click",c),f.$donate_input_title.on("keyup blur change paste input",d),f.$donate_input_flag.on("keyup blur change paste input",e)},c.prototype.bind_editor=function(){function a(){e.data.content=e.ueditor.getContent(),e.content_html_length=e.ueditor.getContentLength(),e.content_text_length=e.ueditor.getContentLength(!0),d()}function c(){e.autosave.call(e)}function d(a){function c(a){f&&e.$editor_error.html(a).show()}function d(){e.$editor_error.hide()}var f=a||!0;e.content_text_length>b.MAX_COUNT_CONTENT?(e.status.content=2,c("正文字数多于"+b.MAX_COUNT_CONTENT+"字")):0===e.content_html_length&&0===e.content_text_length?(e.status.content=0,d()):(e.status.content=1,d()),e.UI.restyle.call(e)}var e=this;this.ueditor.addListener("contentchange blur",a),this.ueditor.addListener("blur",c)},c.prototype.bind_opencomment=function(){function a(){b.$opencomment[0].checked?b.data.open_comment="1":b.data.open_comment="0",b.autosave.call(b)}var b=this;"1"===b.data.open_comment&&(b.$opencomment[0].checked=!0),b.$opencomment.on("click",a)},c.prototype.bind_summary=function(){function c(c){function e(a){h&&(d.$summary_error.hide(),d.$summary_count.addClass("c_red"),k>b.MAX_COUNT_SUMMARY?d.$summary_error.html("推荐理由不能超过"+b.MAX_COUNT_SUMMARY+"字"):0===k&&d.$summary_error.html("推荐理由不能为空"),d.$summary_error.show(),d.$summary_input.addClass("ye_input-error"))}function f(){h&&(d.$summary_error.hide(),d.$summary_input.removeClass("ye_input-error"),d.$summary_count.removeClass("c_red"))}function g(){d.$summary_count.html(k+"/"+b.MAX_COUNT_SUMMARY)}var h=c||!0,i=a.trim(d.$summary_input.val()),j=b.Util.textfilter(i,"script");""!==j&&(d.$summary_input.val(j),i=j);var k=i.length;g(),k>b.MAX_COUNT_SUMMARY?(e(),d.status.summary=2):0===k?(f(),d.status.summary=0):(f(),d.status.summary=1),d.UI.restyle.call(d)}var d=this;d.$summary_input.on("keyup change input paste blur",c)},c.p
rototype.bind_title=function(){function c(c){function e(a){h&&(k>b.MAX_COUNT_TITLE?(d.$title_error.hide(),d.$title_count.addClass("c_red"),d.$title_error.html("标题不能超过"+b.MAX_COUNT_TITLE+"字")):(d.$title_count.removeClass("c_red"),d.$title_error.html("请填写标题")),d.$title_error.show(),d.$title_input.addClass("ye_input-error"))}function f(){h&&(d.$title_error.hide(),d.$title_input.removeClass("ye_input-error"),d.$title_count.removeClass("c_red"))}function g(){d.$title_count.html(k+"/"+b.MAX_COUNT_TITLE)}var h=c||!0,i=a.trim(d.$title_input.val()),j=b.Util.textfilter(i,"script");""!==j&&(d.$title_input.val(j),i=j);var k=i.length;return g(),k>b.MAX_COUNT_TITLE?(e(),d.status.title=2):0===k?(f(),d.status.title=0):(f(),d.status.title=1),d.UI.restyle.call(d),i}var d=this;d.$title_input.on("keyup blur change paste input",function(){var a=c(!0);d.data.title=a,d.UI.articlelist.updateTitle.call(d)}).on("blur",function(){d.autosave()})},c.prototype.Ajax.deleteArticle=function(){var c=this;b.Dialog.uploading("删除中...");var d=b.config.domain+b.URL_AJAX_DEL;a.ajax({url:d,type:"post",dataType:"jsonp",timeout:3e3,data:{article_id:c.data.articleId},error:function(){b.dialog_uploading.hide(),b.Dialog.error("网络故障！")},complete:function(a,c){b.dialog_uploading.hide(),"timeout"===c&&b.Dialog.error("请求超时！")},success:function(a){return 100!=a.code?void b.Dialog.error(a.msg):(clearInterval(c.timer_autosave),c.$container.remove(),delete b.instances[c.timestamp],void b.instances.count--)}})},c.prototype.Ajax.getDonateId=function(){var c=this;if("0"===c.data.open_donate)return b.dialog_cover.hide(),void b.$publish_btn.trigger("publish");if(0===c.status.donateTitle)return b.dialog_cover.hide(),c.$donate_error_title.html("标题不能为空").show(),c.$donate_input_title.addClass("ye_input-error"),b.Dialog.warning("求赏赐标题不能为空"),void(0===c.status.donateFlag&&(c.$donate_input_flag.addClass("ye_input-error"),c.$donate_error_flag.html("感谢语不能为空").show()));if(2===c.status.donateTitle)return b.dialog_cover.hide(),void b.Dialog.warning("求赏赐标题字数太多");if(0===c.status.donateFlag)return b.dialog_cover.hide(),c.$donate_input_flag.addClass("ye_input-error"),c.$donate_error_flag.html("感谢语不能为空").show(),void b.Dialog.warning("求赏赐感谢语不能为空");if(2===c.status.donateFlag)return b.dialog_cover.hide(),void b.Dialog.warning("求赏赐感谢语字数太多");var d=b.URL_AJAX_GET_DONATEID,e=a(".yk-userlog-after-avatar").attr("src"),f=get_username("all").userid,g={create_id:f,target_user_id:f,create_source:3,cost_type:1,cost_set_type:1,target_user_icon:e,cost_set:"5,10,50",title:c.data.donateTitle,send_letter:1,letter_message:c.data.donateFlag},h={plugin_key:"reward",jsondata:JSON.stringify(g)};a.ajax({url:d,type:"get",data:h,timeout:3e3,dataType:"jsonp",error:function(){b.dialog_cover.hide(),b.Dialog.warning("网络不给力 请稍后再试")},complete:function(a,c){b.dialog_cover.hide(),"timeout"===c&&b.Dialog.warning("网络不给力 请稍后再试")},success:function(a){return b.dialog_cover.hide(),a&&0===a.error_code?(c.data.donateId=a.result.mpid,c.updateDonateId(),void b.$publish_btn.trigger("publish")):void(a&&-6==a.error_code?b.Dialog.warning("标题包含敏感词!"):a&&-8==a.error_code?b.Dialog.warning("感谢语包含敏感词!"):b.Dialog.warning("网络不给力 请稍后再试"))}})},c.prototype.Ajax.getPreview=function(){var c=this;a("#qWindowBox_yepreview .preview_qcode_cover").hide(),a.ajax({url:b.URL_AJAX_GET_PREVIEW,data:{article_id:c.data.articleId},type:"get",dataType:"jsonp",timeout:3e3,error:function(a){b.Dialog.error("预览生成失败")},complete:function(a,d){b.dialog_uploading&&b.dialog_uploading.hide(),"timeout"===d&&b.Dialog.warning("网络不给力 请稍后再试"),c.autosave()},success:function(c){c&&c.data||b.Dialog.error("预览生成失败");var d=c.data;b.Dialog.preview(d.qrcode,d.title,d.preview_url),setTimeout(function(){a("#qWindowBox_yepreview .preview_qcode_cover").show()},6e5)}})},c.prototype.Ajax.sendArticle=function(c){var d=this,e=b.config.domain+b.URL_AJAX_SEND;d.data.title=a.trim(d.$title_input.val()),d.data.summary=a.trim(d.$summary_input.val()),d.data.cover=d.$cover_preview_img.attr("src"),d.data.content=d.ueditor.getContent()||"";var f={title:d.data.title,summary:d.data.summary,cover:d.data.cover,con
tent:d.data.content,open_comment:d.data.open_comment};""!==d.data.articleId&&(f.article_id=d.data.articleId),"autosave"!==c&&b.Dialog.uploading("保存中..."),("publish"===c||"preview"===c)&&(f.content=b.Util.clearVoteExtra(f.content)),a.ajax({url:e,type:"post",dataType:"jsonp",data:f,success:function(a){if(b.dialog_uploading&&b.dialog_uploading.hide(),a){if("100"!==a.code)return void("autosave"!==c&&b.Dialog.error(a.msg));d.data.articleId=a.data,d.$editor_subtitle.html("已自动保存 "+b.Util.format_date(new Date,"yyyy-MM-dd hh:mm:ss")).show(),"preview"===c?(b.Dialog.uploading("预览生成中..."),d.Ajax.getPreview.call(d)):"publish"===c?b.Ajax.sendPublish.call(b):"manual"===c&&b.Dialog.success("保存成功")}},error:function(){return b.dialog_uploading&&b.dialog_uploading.hide(),b.Util.log.error("网络故障！"),!1}})},b}(jQuery);